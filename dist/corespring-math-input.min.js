/*! corespring-math-input - v0.0.1 - 2016-01-11
* Copyright (c) 2016 CoreSpring; Licensed MIT */
angular.module("corespring.math-input",[]),angular.module("corespring.math-input").factory("MathInputController",[function(){return function(){return function(a){}}}]),angular.module("corespring.math-input").factory("KeypadDef",["MathInputConfig","$log","$compile",function(a,b,c){function d(b,d){this.link=function(d,e,f,g){function h(){d.onClick=function(a){_.isFunction(d.onClickCallback)&&d.onClickCallback({action:a})}}function i(){var a=$(b()),f=$(a);e.html(f),c(f)(d),h()}(new a).postLink(d),i()}}b.debug.bind(b,"[new-keypad-def]");return d}]),angular.module("corespring.math-input").directive("keypad",["KeypadDef",function(a){function b(){return['<div class="keypad" ng-class="keypadType">','  <div class="{{ sections[section].code }}-section" ng-repeat="section in types[keypadType].sections">','    <button ng-repeat="button in sections[section].buttons" ','            id="{{button}}-button"','            class="button {{buttons[button].cssClass}}"','            title="{{buttons[button].name}}"','            ng-disabled="buttons[button].disabled"','            ng-click="onClick(button)">','            <div ng-bind-html="buttons[button].symbol"></div></button>',"  </div>","</div>"].join("\n")}var c=new a(b);return{restrict:"E",link:c.link,replace:!0,scope:{keypadType:"=",showKeypad:"=",onClickCallback:"&"}}}]),angular.module("corespring.math-input").factory("MathInputConfig",["$sce",function(a){function b(){this.postLink=function(a){a.types=e,a.sections=d,a.buttons=c}}var c={};c.left={id:"left",name:"Move left",symbol:a.trustAsHtml("&larr;"),logic:"cursor",command:"moveLeft",shortcut:"",cssClass:"cursor"},c.right={id:"right",name:"Move right",symbol:a.trustAsHtml("&rarr;"),logic:"cursor",command:"moveRight",shortcut:"",cssClass:"cursor"},c.up={id:"up",name:"Move up",symbol:a.trustAsHtml("&uarr;"),logic:"cursor",command:"",shortcut:"moveUp",cssClass:"cursor"},c.down={id:"down",name:"Move down",symbol:a.trustAsHtml("&darr;"),logic:"cursor",command:"moveDown",shortcut:"",cssClass:"cursor"},c.backspace={id:"backspace",name:"Backspace",symbol:a.trustAsHtml("&LeftArrowBar;"),logic:"cursor",command:"backspace",shortcut:"",cssClass:"cursor"},c.one={id:"one",name:"One",symbol:a.trustAsHtml("1"),logic:"write",command:"1",shortcut:"",cssClass:"number"},c.two={id:"two",name:"Two",symbol:a.trustAsHtml("2"),logic:"cmd",command:"2",shortcut:"",cssClass:"number"},c.three={id:"three",name:"Three",symbol:a.trustAsHtml("3"),logic:"cmd",command:"3",shortcut:"",cssClass:"number"},c.four={id:"four",name:"Four",symbol:a.trustAsHtml("4"),logic:"cmd",command:"4",shortcut:"",cssClass:"number"},c.five={id:"five",name:"Five",symbol:a.trustAsHtml("5"),logic:"cmd",command:"5",shortcut:"",cssClass:"number"},c.six={id:"six",name:"Six",symbol:a.trustAsHtml("6"),logic:"cmd",command:"6",shortcut:"",cssClass:"number"},c.seven={id:"seven",name:"Seven",symbol:a.trustAsHtml("7"),logic:"cmd",command:"7",shortcut:"",cssClass:"number"},c.eight={id:"eight",name:"Eight",symbol:a.trustAsHtml("8"),logic:"cmd",command:"8",shortcut:"",cssClass:"number"},c.nine={id:"nine",name:"Nine",symbol:a.trustAsHtml("9"),logic:"cmd",command:"9",shortcut:"",cssClass:"number"},c.zero={id:"zero",name:"Zero",symbol:a.trustAsHtml("0"),logic:"cmd",command:"0",shortcut:"",cssClass:"number"},c.decimal={id:"decimal",name:"Decimal point",symbol:a.trustAsHtml("."),logic:"cmd",command:".",shortcut:"",cssClass:"number"},c.equals={id:"equals",name:"Equals",symbol:a.trustAsHtml("="),logic:"cmd",command:"=",shortcut:"",cssClass:"number"},c.plus={id:"plus",name:"Plus",symbol:a.trustAsHtml("+"),logic:"cmd",command:"+",shortcut:"",cssClass:"basic-operation"},c.minus={id:"minus",name:"Minus",symbol:a.trustAsHtml("-"),logic:"cmd",command:"-",shortcut:"",cssClass:"basic-operation"},c.multiply={id:"multiply",name:"Multiply",symbol:a.trustAsHtml("x"),logic:"cmd",command:"\\times",shortcut:"",cssClass:"basic-operation"},c.divide={id:"divide",name:"Divide",symbol:a.trustAsHtml("&#247"),logic:"cmd",command:"\\div",shortcut:"",cssClass:"basic-operation"},c.sqrt={id:"sqrt",name:"Square root",symbol:a.trustAsHtml("&#8730"),logic:"cmd",command:"\\sqrt",shortcut:"",cssClass:"root"},c.root={id:"root",name:"Root",symbol:a.trustAsHtml("n&#8730"),logic:"write",command:"\\sqrt[{}]{}",shortcut:"",cssClass:"root"},c.fraction={id:"fraction",name:"Fraction",symbol:a.trustAsHtml("x/n"),logic:"cmd",command:"\\frac",shortcut:"",cssClass:"fraction"},c.mixed_fraction={id:"mixed_fraction",name:"Mixed fraction",symbol:a.trustAsHtml("x a/b"),logic:"write",command:"x\\frac{}{}",shortcut:"",cssClass:"fraction"},c.subscript={id:"subscript",name:"Subscript",symbol:a.trustAsHtml("x_n"),logic:"cmd",command:"_",shortcut:"",cssClass:"sub-sup"},c.superscript={id:"superscript",name:"Superscript",symbol:a.trustAsHtml("x^n"),logic:"cmd",command:"^",shortcut:"",cssClass:"sub-sup"},c.x={id:"x",name:"X",symbol:a.trustAsHtml("x"),logic:"cmd",command:"x",shortcut:"",cssClass:"vars"},c.y={id:"y",name:"Y",symbol:a.trustAsHtml("y"),logic:"cmd",command:"y",shortcut:"",cssClass:"vars"},c.percentage={id:"percentage",name:"Percentage",symbol:a.trustAsHtml("%"),logic:"cmd",command:"%",shortcut:"",cssClass:"misc"},c.parenthesis={id:"parenthesis",name:"Parenthesis",symbol:a.trustAsHtml("( )"),logic:"cmd",command:"(",shortcut:"",cssClass:"misc"},c.absolute_value={id:"absolute_value",name:"Absolute Value",symbol:a.trustAsHtml("| |"),logic:"cmd",command:"|",shortcut:"",cssClass:"misc"},c.degree={id:"degree",name:"Degree",symbol:a.trustAsHtml("°"),logic:"cmd",command:"°",shortcut:"",cssClass:"misc"},c.le={id:"le",name:"Less than or equal",symbol:a.trustAsHtml("<="),logic:"cmd",command:"\\le",shortcut:"",cssClass:"comparison"},c.lt={id:"lt",name:"Less than",symbol:a.trustAsHtml("<"),logic:"cmd",command:"<",shortcut:"",cssClass:"comparison"},c.gt={id:"gt",name:"Greater than",symbol:a.trustAsHtml(">"),logic:"cmd",command:">",shortcut:"",cssClass:"comparison"},c.ge={id:"ge",name:"Greater than or equal",symbol:a.trustAsHtml(">="),logic:"cmd",command:"\\ge",shortcut:"",cssClass:"comparison"};var d={};d.cursor={name:"Move cursor section",buttons:["left","right","up","down","backspace"],code:"cursor"},d.numeric={name:"Numeric section",buttons:["seven","eight","nine","four","five","six","one","two","three","zero","decimal","equals"],code:"numeric"},d.basic={name:"Basic functions section",buttons:["plus","minus","multiply","divide"],code:"basic"},d.advanced={name:"Advanced section",buttons:["sqrt","root","fraction","mixed_fraction","superscript","subscript","x","y","percentage","parenthesis","absolute_value","degree","le","lt","gt","ge"],code:"advanced"};var e={};return e.basic={name:"Basic",sections:["cursor","numeric","basic","advanced"]},b}]),angular.module("corespring.math-input").factory("MathInputDef",["MathInputConfig","$log","$compile","$document","$timeout",function(a,b,c,d,e){function f(b,f){this.link=function(f,h,i){function j(a,c){var d=$(b()),e=$(d);return f.instanceId=Math.random().toString(36).substring(7),e.attr("id",f.instanceId),g("Instance ID: "+f.instanceId),e}function k(){h.on("focus",".mathquill-editable",function(a){f.showKeypad===!1&&d.mousedown(),f.showKeypad=!0,f.focusedInput=$(this),f.$apply(function(){d.on("mousedown",function(a){f.$apply(function(){$.contains(d[0].getElementById(f.instanceId),a.target)||(f.showKeypad=!1,d.off("mousedown"))})})})}),f.clickButton=function(a){var b=f.buttons[a];g("Clicked button: "+a),"cursor"===b.logic||"cmd"===b.logic||"write"===b.logic?(f.focusedInput.mathquill(b.logic,b.command),e(function(){f.focusedInput.find("textarea").focus()},1)):g("Not supported. [ Logic: "+b.logic+", Action: "+a+"]")}}function l(){g("Math input init..."),f.showKeypad=!1,f.focusedInput=null;var a=j(h,i);h.html(a),c(a)(f),k()}(new a).postLink(f),l()}}var g=b.debug.bind(b,"[math-input-def]");return f}]),angular.module("corespring.math-input").directive("mathInput",["MathInputController","MathInputDef",function(a,b){function c(){return['<div class="math-input">','  <div class="input" ng-class="{ \'dotted\': dotted }">',"    <span ng-class=\"editable ? 'mathquill-editable' : 'mathquill-embedded-latex'\">{{expression}}</span>","  </div>",'  <keypad ng-show="showKeypad" keypad-type="keypadType" show-keypad="showKeypad" on-click-callback="clickButton(action)"></keypad>',"</div>"].join("\n")}var d=new b(c);return{restrict:"E",link:d.link,replace:!0,scope:{expression:"=",editable:"=",dotted:"=",keypadType:"="}}}]);